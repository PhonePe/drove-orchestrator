<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://phonepe.github.io/drove-orchestrator/cluster/setup/zookeeper.html">
      
      
        <link rel="prev" href="prerequisites.html">
      
      
        <link rel="next" href="controller.html">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Setting Up Zookeeper - Drove Container Orchestrator</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
        <script src="../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-zookeeper" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Drove Container Orchestrator" class="md-header__button md-logo" aria-label="Drove Container Orchestrator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Drove Container Orchestrator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setting Up Zookeeper
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to system preference" type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/PhonePe/drove-orchestrator" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started.html" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../cluster.html" class="md-tabs__link">
          
  
  
  Cluster

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../applications/index.html" class="md-tabs__link">
          
  
  
  Applications

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tasks/index.html" class="md-tabs__link">
          
  
  
  Tasks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../apis/index.html" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cli/index.html" class="md-tabs__link">
          
  
  
  Drove CLI

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../extra/epoch.html" class="md-tabs__link">
          
  
  
  Extra

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Drove Container Orchestrator" class="md-nav__button md-logo" aria-label="Drove Container Orchestrator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    Drove Container Orchestrator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PhonePe/drove-orchestrator" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Cluster
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cluster
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anatomy of a Drove Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="planning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Planning your cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="prerequisites.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up the prerequisites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Setting Up Zookeeper
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="zookeeper.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting Up Zookeeper
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#relevant-directories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relevant directories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relevant directories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Important files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-configuration-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup configuration files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup configuration files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup environment variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-jvm-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup JVM parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure logging
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-systemd-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Systemd File
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-service-on-all-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Start the service on all servers
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="controller.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up Controllers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="executor-setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up Executor Nodes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gateway.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up Drove Gateway
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="coredns-drove.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up CoreDNS Drove
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="maintenance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maintaining a Drove Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="units.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Units Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../maintenance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Maintaining a Drove Cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Applications
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Applications
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/instances.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Instances
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/specification.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Specification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/operations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/outage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outage Detection and Recovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/specification.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Specification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/operations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/application.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/task.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Task Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/logs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Log Related APIs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/cluster.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7">
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Drove CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Drove CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Drove CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3">
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/appinstances.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove appinstances
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/apps.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove apps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/cluster.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/describe.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove describe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/executor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove executor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/localservices.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove localservices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/lsinstances.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove lsinstances
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/tasks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    drove tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8">
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Extra
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Extra
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/epoch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Epoch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/libraries.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Libraries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/nvidia.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up Nvidia GPU computation on executor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#relevant-directories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relevant directories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relevant directories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Important files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-configuration-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup configuration files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup configuration files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup environment variables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-jvm-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup JVM parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure logging
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-systemd-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Systemd File
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-service-on-all-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Start the service on all servers
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation">
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../index.html" class="md-path__link">
        
  <span class="md-ellipsis">
    Introduction
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../cluster.html" class="md-path__link">
          
  <span class="md-ellipsis">
    Cluster
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="planning.html" class="md-path__link">
          
  <span class="md-ellipsis">
    Setup
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="setting-up-zookeeper">Setting Up Zookeeper<a class="headerlink" href="#setting-up-zookeeper" title="Permanent link">¶</a></h1>
<p>We shall be running Zookeeper using the official Docker images. All data volumes etc will be mounted on the host machines.</p>
<p>The following ports will be exposed:</p>
<ul>
<li><code>2181</code> - This is the main port for ZK clients to connect to the server</li>
<li><code>2888</code> - The port used by Zookeeper for in-cluster communications between peers</li>
<li><code>3888</code> - Port used for internal leader election</li>
<li><code>8080</code> - Admin server port. We are going to turn this off.</li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The ZK admin server does not shut down cleanly from time to time. And is not needed for anything related to Drove. If not needed, you should turn it off.</p>
</div>
<p>We assume the following to be the IP for the 3 zookeeper nodes:</p>
<ul>
<li>192.168.3.10</li>
<li>192.168.3.11</li>
<li>192.168.3.12</li>
</ul>
<h2 id="relevant-directories">Relevant directories<a class="headerlink" href="#relevant-directories" title="Permanent link">¶</a></h2>
<p>Location for data and logs are as follows:</p>
<ul>
<li><code>/etc/drove/zk</code> - Configuration files</li>
<li><code>/var/lib/drove/zk/</code> - Data and data logs</li>
<li><code>/var/log/drove/zk</code> - Logs</li>
</ul>
<h3 id="important-files">Important files<a class="headerlink" href="#important-files" title="Permanent link">¶</a></h3>
<p>The zookeeper container stores snapshots, transaction logs and application logs on <code>/data</code>, <code>/datalog</code> and <code>/logs</code> directories respectively. We shall be volume mounting the following:</p>
<ul>
<li><code>/var/lib/drove/zk/data</code> to <code>/data</code> on the container</li>
<li><code>/var/lib/drove/zk/datalog</code> to <code>/datalog</code> on the container</li>
<li><code>/var/logs/drove/zk</code> to <code>/logs</code> on the container</li>
</ul>
<p>Docker will create these directories when container comes up for the first time.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The zk server id (as set above using the <code>ZOO_MY_ID</code>) can <em>also</em> be set by putting the server number in a file named <code>myid</code> in the <code>/data</code> directory.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Prerequisite Setup</p>
<p>If not done already, lease complete the <a href="prerequisites.html">prerequisite setup</a> on all machines earmarked for the cluster.</p>
</div>
<h2 id="setup-configuration-files">Setup configuration files<a class="headerlink" href="#setup-configuration-files" title="Permanent link">¶</a></h2>
<p>Let's create the config directory:</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/drove/zk
</code></pre></div>
<p>We shall be creating 3 different configuration files to configure zookeeper:</p>
<ul>
<li><code>zk.env</code> - Environment variables to be used by zookeeper container</li>
<li><code>java.env</code> - Setup JVM related options</li>
<li><code>logbaxk.xml</code> - Logging configuration</li>
</ul>
<h3 id="setup-environment-variables">Setup environment variables<a class="headerlink" href="#setup-environment-variables" title="Permanent link">¶</a></h3>
<p>Let us prepare the configuration. Put the following in a file: <code>/etc/drove/zk/zk.env</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c">#(1)!</span>
ZOO_TICK_TIME<span class="s">=2000</span>
ZOO_INIT_LIMIT<span class="s">=10</span>
ZOO_SYNC_LIMIT<span class="s">=5</span>
ZOO_STANDALONE_ENABLED<span class="s">=false</span>
ZOO_ADMINSERVER_ENABLED<span class="s">=false</span>

<span class="c">#(2)!</span>
ZOO_AUTOPURGE_PURGEINTERVAL<span class="s">=12</span>
ZOO_AUTOPURGE_SNAPRETAINCOUNT<span class="s">=5</span>

<span class="c">#(3)!</span>
ZOO_MY_ID<span class="s">=1</span>
ZOO_SERVERS<span class="s">=server.1=192.168.3.10</span><span class="p">:</span><span class="m">2888</span><span class="p">:</span><span class="m">3888</span><span class="s">;2181 server.2=192.168.3.11</span><span class="p">:</span><span class="m">2888</span><span class="p">:</span><span class="m">3888</span><span class="s">;2181 server.3=192.168.3.12</span><span class="p">:</span><span class="m">2888</span><span class="p">:</span><span class="m">3888</span><span class="s">;2181</span>
</code></pre></div>
<ol>
<li>This is cluster level configuration to ensure the cluster topology remains stable through minor flaps</li>
<li>This will control how much data we retain</li>
<li>This section needs to change per server. Each server should have a different <code>ZOO_MY_ID</code> set. And the same numbers get referred to in <code>ZOO_SERVERS</code> section.</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>
<p>The <code>ZOO_MY_ID</code> value needs to be different on <em>every</em> server.So it would be:</p>
<ul>
<li>192.168.3.10 - 1</li>
<li>192.168.3.11 - 2</li>
<li>192.168.3.12 - 3</li>
</ul>
</li>
<li>
<p>The format for <code>ZOO_SERVERS</code> is <code>server.id=&lt;address1&gt;:&lt;port1&gt;:&lt;port2&gt;[:role];[&lt;client port address&gt;:]&lt;client port&gt;</code>.</p>
</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Exhaustive set of options can be found on the <a href="https://hub.docker.com/_/zookeeper/#configuration">Official Docker Page</a>.</p>
</div>
<h3 id="setup-jvm-parameters">Setup JVM parameters<a class="headerlink" href="#setup-jvm-parameters" title="Permanent link">¶</a></h3>
<p>Put the following in <code>/etc/drove/zk/java.env</code></p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SERVER_JVMFLAGS</span><span class="o">=</span><span class="s1">'-Djute.maxbuffer=0x9fffff -Xmx4g -Xms4g -Dfile.encoding=utf-8 -XX:+UseG1GC -XX:+UseNUMA -XX:+ExitOnOutOfMemoryError'</span>
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Configuring Max Data Size</p>
<p>Drove data per node can get a bit on the larger side from time to time depending on your application configuration. To be on the safe side, we need to increase the maximum data size per node. This is achieved by setting the JVM option <code>-Djute.maxbuffer=0x9fffff</code> on <em>all</em> cluster nodes in Drove. This is 10MB (approx). The actual payload doesn't reach anywhere close. However we shall be picking up payload compression in a future version to stop this variable from needing to be set.</p>
<p>For the Zookeeper Docker, the environment variable <code>SERVER_JVMFLAGS</code> needs to be set to <code>-Djute.maxbuffer=0x9fffff</code>.</p>
<p>Please refer to <a href="https://zookeeper.apache.org/doc/r3.6.2/zookeeperAdmin.html">Zookeeper Advanced Configuration</a> for further properties that can be tuned.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">JVM Size</p>
<p>We set 4GB JVM heap size for ZK by adding appropriate options in <code>SERVER_JVMFLAGS</code>. Please make sure you have sized your machines to have 10-16GB of RAM at the very least. Tune the JVM size and machine size according to your needs.</p>
</div>
<p>q</p>
<div class="admonition danger">
<p class="admonition-title"><code>JVMFLAGS</code> environment variable</p>
<p>Do not set this variable in <code>zk.env</code>. Couple of reasons:</p>
<ul>
<li>This will affect <em>both</em> the zk server <em>as well as</em> the client.</li>
<li>There is an <a href="https://stackoverflow.com/questions/56497140/zookeeper-ignores-jvmflags">issue</a> and the flag (nor the <code>SERVER_JVMFLAGS</code>) are <em>not</em> used properly by the startup scripts.</li>
</ul>
</div>
<h3 id="configure-logging">Configure logging<a class="headerlink" href="#configure-logging" title="Permanent link">¶</a></h3>
<p>We want to have physical log files on disk for debugging and audits and want the container to be ephemeral to allow for easy updates etc. To achieve this, put the following in <code>/etc/drove/zk/logback.xml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!--</span>
<span class="cm"> Copyright 2022 The Apache Software Foundation</span>

<span class="cm"> Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="cm"> or more contributor license agreements.  See the NOTICE file</span>
<span class="cm"> distributed with this work for additional information</span>
<span class="cm"> regarding copyright ownership.  The ASF licenses this file</span>
<span class="cm"> to you under the Apache License, Version 2.0 (the</span>
<span class="cm"> "License"); you may not use this file except in compliance</span>
<span class="cm"> with the License.  You may obtain a copy of the License at</span>

<span class="cm">     http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="cm"> Unless required by applicable law or agreed to in writing, software</span>
<span class="cm"> distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="cm"> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm"> See the License for the specific language governing permissions and</span>
<span class="cm"> limitations under the License.</span>

<span class="cm"> Define some default values that can be overridden by system properties</span>
<span class="cm">--&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- Uncomment this if you would like to expose Logback JMX beans --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!--jmxConfigurator /--&gt;</span>

<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.console.threshold"</span><span class="w"> </span><span class="na">value=</span><span class="s">"INFO"</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.log.dir"</span><span class="w"> </span><span class="na">value=</span><span class="s">"/logs"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.log.file"</span><span class="w"> </span><span class="na">value=</span><span class="s">"zookeeper.log"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.log.threshold"</span><span class="w"> </span><span class="na">value=</span><span class="s">"INFO"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.log.maxfilesize"</span><span class="w"> </span><span class="na">value=</span><span class="s">"256MB"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.log.maxbackupindex"</span><span class="w"> </span><span class="na">value=</span><span class="s">"20"</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="cm">&lt;!--</span>
<span class="cm">    console</span>
<span class="cm">    Add "console" to root logger if you want to use this</span>
<span class="cm">  --&gt;</span>
<span class="w">  </span><span class="nt">&lt;appender</span><span class="w"> </span><span class="na">name=</span><span class="s">"CONSOLE"</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;encoder&gt;</span>
<span class="w">      </span><span class="nt">&lt;pattern&gt;</span>%d{ISO8601}<span class="w"> </span>[myid:%X{myid}]<span class="w"> </span>-<span class="w"> </span>%-5p<span class="w"> </span>[%t:%C{1}@%L]<span class="w"> </span>-<span class="w"> </span>%m%n<span class="nt">&lt;/pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/encoder&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;level&gt;</span>${zookeeper.console.threshold}<span class="nt">&lt;/level&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">  </span><span class="nt">&lt;/appender&gt;</span>

<span class="w">  </span><span class="cm">&lt;!--</span>
<span class="cm">    Add ROLLINGFILE to root logger to get log file output</span>
<span class="cm">  --&gt;</span>
<span class="w">  </span><span class="nt">&lt;appender</span><span class="w"> </span><span class="na">name=</span><span class="s">"ROLLINGFILE"</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;File&gt;</span>${zookeeper.log.dir}/${zookeeper.log.file}<span class="nt">&lt;/File&gt;</span>
<span class="w">    </span><span class="nt">&lt;encoder&gt;</span>
<span class="w">      </span><span class="nt">&lt;pattern&gt;</span>%d{ISO8601}<span class="w"> </span>[myid:%X{myid}]<span class="w"> </span>-<span class="w"> </span>%-5p<span class="w"> </span>[%t:%C{1}@%L]<span class="w"> </span>-<span class="w"> </span>%m%n<span class="nt">&lt;/pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/encoder&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;level&gt;</span>${zookeeper.log.threshold}<span class="nt">&lt;/level&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;rollingPolicy</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.FixedWindowRollingPolicy"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;maxIndex&gt;</span>${zookeeper.log.maxbackupindex}<span class="nt">&lt;/maxIndex&gt;</span>
<span class="w">      </span><span class="nt">&lt;FileNamePattern&gt;</span>${zookeeper.log.dir}/${zookeeper.log.file}.%i<span class="nt">&lt;/FileNamePattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/rollingPolicy&gt;</span>
<span class="w">    </span><span class="nt">&lt;triggeringPolicy</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;MaxFileSize&gt;</span>${zookeeper.log.maxfilesize}<span class="nt">&lt;/MaxFileSize&gt;</span>
<span class="w">    </span><span class="nt">&lt;/triggeringPolicy&gt;</span>
<span class="w">  </span><span class="nt">&lt;/appender&gt;</span>

<span class="w">  </span><span class="cm">&lt;!--</span>
<span class="cm">    Add TRACEFILE to root logger to get log file output</span>
<span class="cm">    Log TRACE level and above messages to a log file</span>
<span class="cm">  --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!--property name="zookeeper.tracelog.dir" value="${zookeeper.log.dir}" /&gt;</span>
<span class="cm">  &lt;property name="zookeeper.tracelog.file" value="zookeeper_trace.log" /&gt;</span>
<span class="cm">  &lt;appender name="TRACEFILE" class="ch.qos.logback.core.FileAppender"&gt;</span>
<span class="cm">    &lt;File&gt;${zookeeper.tracelog.dir}/${zookeeper.tracelog.file}&lt;/File&gt;</span>
<span class="cm">    &lt;encoder&gt;</span>
<span class="cm">      &lt;pattern&gt;%d{ISO8601} [myid:%X{myid}] - %-5p [%t:%C{1}@%L] - %m%n&lt;/pattern&gt;</span>
<span class="cm">    &lt;/encoder&gt;</span>
<span class="cm">    &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt;</span>
<span class="cm">      &lt;level&gt;TRACE&lt;/level&gt;</span>
<span class="cm">    &lt;/filter&gt;</span>
<span class="cm">  &lt;/appender--&gt;</span>

<span class="w">  </span><span class="cm">&lt;!--</span>
<span class="cm">    zk audit logging</span>
<span class="cm">  --&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.auditlog.file"</span><span class="w"> </span><span class="na">value=</span><span class="s">"zookeeper_audit.log"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"zookeeper.auditlog.threshold"</span><span class="w"> </span><span class="na">value=</span><span class="s">"INFO"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">"audit.logger"</span><span class="w"> </span><span class="na">value=</span><span class="s">"INFO, RFAAUDIT"</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;appender</span><span class="w"> </span><span class="na">name=</span><span class="s">"RFAAUDIT"</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;File&gt;</span>${zookeeper.log.dir}/${zookeeper.auditlog.file}<span class="nt">&lt;/File&gt;</span>
<span class="w">    </span><span class="nt">&lt;encoder&gt;</span>
<span class="w">      </span><span class="nt">&lt;pattern&gt;</span>%d{ISO8601}<span class="w"> </span>%p<span class="w"> </span>%c{2}:<span class="w"> </span>%m%n<span class="nt">&lt;/pattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/encoder&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.classic.filter.ThresholdFilter"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;level&gt;</span>${zookeeper.auditlog.threshold}<span class="nt">&lt;/level&gt;</span>
<span class="w">    </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;rollingPolicy</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.FixedWindowRollingPolicy"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;maxIndex&gt;</span>10<span class="nt">&lt;/maxIndex&gt;</span>
<span class="w">      </span><span class="nt">&lt;FileNamePattern&gt;</span>${zookeeper.log.dir}/${zookeeper.auditlog.file}.%i<span class="nt">&lt;/FileNamePattern&gt;</span>
<span class="w">    </span><span class="nt">&lt;/rollingPolicy&gt;</span>
<span class="w">    </span><span class="nt">&lt;triggeringPolicy</span><span class="w"> </span><span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;MaxFileSize&gt;</span>10MB<span class="nt">&lt;/MaxFileSize&gt;</span>
<span class="w">    </span><span class="nt">&lt;/triggeringPolicy&gt;</span>
<span class="w">  </span><span class="nt">&lt;/appender&gt;</span>

<span class="w">  </span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">"org.apache.zookeeper.audit.Slf4jAuditLogger"</span><span class="w"> </span><span class="na">additivity=</span><span class="s">"false"</span><span class="w"> </span><span class="na">level=</span><span class="s">"${audit.logger}"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;appender-ref</span><span class="w"> </span><span class="na">ref=</span><span class="s">"RFAAUDIT"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/logger&gt;</span>

<span class="w">  </span><span class="nt">&lt;root</span><span class="w"> </span><span class="na">level=</span><span class="s">"INFO"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;appender-ref</span><span class="w"> </span><span class="na">ref=</span><span class="s">"CONSOLE"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;appender-ref</span><span class="w"> </span><span class="na">ref=</span><span class="s">"ROLLINGFILE"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is a customization of the original file from <a href="https://github.com/apache/zookeeper/blob/branch-3.8/conf/logback.xml">Zookeeper source tree</a>. Please refer to <a href="https://zookeeper.apache.org/doc/r3.8.0/zookeeperAdmin.html#sc_logging">documentation</a> to configure logging.</p>
</div>
<h2 id="create-systemd-file">Create Systemd File<a class="headerlink" href="#create-systemd-file" title="Permanent link">¶</a></h2>
<p>Create a <code>systemd</code> file. Put the following in <code>/etc/systemd/system/drove.zookeeper.service</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">Drove Zookeeper Service</span>
<span class="na">After</span><span class="o">=</span><span class="s">docker.service</span>
<span class="na">Requires</span><span class="o">=</span><span class="s">docker.service</span>

<span class="k">[Service]</span>
<span class="na">User</span><span class="o">=</span><span class="s">drove</span>
<span class="na">Group</span><span class="o">=</span><span class="s">docker</span>
<span class="na">TimeoutStartSec</span><span class="o">=</span><span class="s">0</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">ExecStartPre</span><span class="o">=</span><span class="s">-/usr/bin/docker pull zookeeper:3.8</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/docker run </span>\
<span class="w">    </span><span class="s">--env-file /etc/drove/zk/zk.env </span>\
<span class="w">    </span><span class="s">--volume /var/lib/drove/zk/data:/data </span>\
<span class="w">    </span><span class="s">--volume /var/lib/drove/zk/datalog:/datalog </span>\
<span class="w">    </span><span class="s">--volume /var/log/drove/zk:/logs </span>\
<span class="w">    </span><span class="s">--volume /etc/drove/zk/logback.xml:/conf/logback.xml </span>\
<span class="w">    </span><span class="s">--volume /etc/drove/zk/java.env:/conf/java.env </span>\
<span class="w">    </span><span class="s">--publish 2181:2181 </span>\
<span class="w">    </span><span class="s">--publish 2888:2888 </span>\
<span class="w">    </span><span class="s">--publish 3888:3888 </span>\
<span class="w">    </span><span class="s">--rm </span>\
<span class="w">    </span><span class="s">--name drove.zookeeper </span>\
<span class="w">    </span><span class="s">zookeeper:3.8</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>
<p>Verify the file with the following command:
</p><div class="highlight"><pre><span></span><code>systemd-analyze<span class="w"> </span>verify<span class="w"> </span>drove.zookeeper.service
</code></pre></div><p></p>
<p>Set permissions
</p><div class="highlight"><pre><span></span><code>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span>/etc/systemd/system/drove.zookeeper.service
</code></pre></div><p></p>
<h2 id="start-the-service-on-all-servers">Start the service on all servers<a class="headerlink" href="#start-the-service-on-all-servers" title="Permanent link">¶</a></h2>
<p>Use the following to start the service:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>daemon-reload
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>drove.zookeeper
systemctl<span class="w"> </span>start<span class="w"> </span>drove.zookeeper
</code></pre></div>
<p>You can check server status using the following:</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>srvr<span class="w"> </span><span class="p">|</span><span class="w"> </span>nc<span class="w"> </span>localhost<span class="w"> </span><span class="m">2181</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Replace <code>localhost</code> on the above command with the actual ZK server IPs to test remote connectivity.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can access the ZK client from the container using the following command:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>drove.zookeeper<span class="w"> </span>bin/zkCli.sh
</code></pre></div>
<p>To connect to remote host you can use the following:
</p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>drove.zookeeper<span class="w"> </span>bin/zkCli.sh<span class="w"> </span>-server<span class="w"> </span>&lt;server<span class="w"> </span>name<span class="w"> </span>or<span class="w"> </span>ip&gt;:2181
</code></pre></div><p></p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2024  PhonePe Private Limited
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tracking", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "content.code.annotate", "navigation.expand", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  
<script id="init-glightbox">document.querySelectorAll('.glightbox').forEach(function(element) {
    try {
        var img = element.querySelector('img');
        if (img && img.src) {
            element.setAttribute('href', img.src);
        } else {
            console.log('No img element with src attribute found');
        }
    } catch (error) {
        console.log('Error:', error);
    }
});
const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>