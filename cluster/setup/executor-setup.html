
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://phonepe.github.io/drove-orchestrator/cluster/setup/executor-setup.html">
      
      
        <link rel="prev" href="controller.html">
      
      
        <link rel="next" href="gateway.html">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Setting up Executor Nodes - Drove Container Orchestrator</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="../../assets/external/unpkg.com/iframe-worker/shim.js"></script>
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-executor-nodes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Drove Container Orchestrator" class="md-header__button md-logo" aria-label="Drove Container Orchestrator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Drove Container Orchestrator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Setting up Executor Nodes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PhonePe/drove-orchestrator" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started.html" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../cluster.html" class="md-tabs__link">
          
  
  Cluster

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../applications/index.html" class="md-tabs__link">
          
  
  Applications

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tasks/index.html" class="md-tabs__link">
          
  
  Tasks

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../apis/index.html" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../extra/cli.html" class="md-tabs__link">
          
  
  Extra

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Drove Container Orchestrator" class="md-nav__button md-logo" aria-label="Drove Container Orchestrator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Drove Container Orchestrator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PhonePe/drove-orchestrator" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cluster
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cluster
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anatomy of a Drove Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="planning.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning your cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="prerequisites.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up the prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="zookeeper.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting Up Zookeeper
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="controller.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up Controllers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Setting up Executor Nodes
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="executor-setup.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Setting up Executor Nodes
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#considerations-and-tuning-for-hardware-and-operating-system" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations and tuning for hardware and operating system
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Considerations and tuning for hardware and operating system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-and-memory-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      CPU and Memory considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CPU and Memory considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#over-provisioning-of-cpu-and-memory" class="md-nav__link">
    <span class="md-ellipsis">
      Over Provisioning of CPU and Memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-numa-pinning" class="md-nav__link">
    <span class="md-ellipsis">
      Disable NUMA Pinning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hyper-threading" class="md-nav__link">
    <span class="md-ellipsis">
      Hyper-threading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isolating-container-and-os-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Isolating container and OS processes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu-computation" class="md-nav__link">
    <span class="md-ellipsis">
      GPU Computation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-consideration" class="md-nav__link">
    <span class="md-ellipsis">
      Storage consideration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executor-configuration-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Executor Configuration Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executor Configuration Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zookeeper-connection-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Zookeeper Connection Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intra-node-authentication-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Intra Node Authentication Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drove-application-logger-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Drove Application Logger Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#over-provisioning-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Over provisioning configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executor-options" class="md-nav__link">
    <span class="md-ellipsis">
      Executor Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relevant-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Relevant directories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-the-config-file" class="md-nav__link">
    <span class="md-ellipsis">
      Setup the config file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-required-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Setup required environment variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-systemd-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create systemd file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-service-on-all-servers" class="md-nav__link">
    <span class="md-ellipsis">
      Start the service on all servers
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gateway.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up Drove Gateway
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="coredns-drove.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up CoreDNS Drove
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="maintenance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintaining a Drove Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="units.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Units Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/instances.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Instances
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/specification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/operations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/outage.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Outage Detection and Recovery
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/specification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/operations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task Operations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/application.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/task.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Task Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/logs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log Related APIs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../apis/cluster.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Extra
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Extra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/cli.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Drove CLI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/epoch.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Epoch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/libraries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Libraries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra/nvidia.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up Nvidia GPU computation on executor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#considerations-and-tuning-for-hardware-and-operating-system" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations and tuning for hardware and operating system
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Considerations and tuning for hardware and operating system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-and-memory-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      CPU and Memory considerations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CPU and Memory considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#over-provisioning-of-cpu-and-memory" class="md-nav__link">
    <span class="md-ellipsis">
      Over Provisioning of CPU and Memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disable-numa-pinning" class="md-nav__link">
    <span class="md-ellipsis">
      Disable NUMA Pinning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hyper-threading" class="md-nav__link">
    <span class="md-ellipsis">
      Hyper-threading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isolating-container-and-os-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Isolating container and OS processes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gpu-computation" class="md-nav__link">
    <span class="md-ellipsis">
      GPU Computation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-consideration" class="md-nav__link">
    <span class="md-ellipsis">
      Storage consideration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executor-configuration-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Executor Configuration Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Executor Configuration Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zookeeper-connection-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Zookeeper Connection Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intra-node-authentication-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Intra Node Authentication Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drove-application-logger-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Drove Application Logger Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#over-provisioning-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Over provisioning configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executor-options" class="md-nav__link">
    <span class="md-ellipsis">
      Executor Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relevant-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Relevant directories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-the-config-file" class="md-nav__link">
    <span class="md-ellipsis">
      Setup the config file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-required-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Setup required environment variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-systemd-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create systemd file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-the-service-on-all-servers" class="md-nav__link">
    <span class="md-ellipsis">
      Start the service on all servers
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="setting-up-executor-nodes">Setting up Executor Nodes<a class="headerlink" href="#setting-up-executor-nodes" title="Permanent link">&para;</a></h1>
<p>We shall setup the executor nodes by setting up the hardware, operating system first and then the executor service itself.</p>
<h2 id="considerations-and-tuning-for-hardware-and-operating-system">Considerations and tuning for hardware and operating system<a class="headerlink" href="#considerations-and-tuning-for-hardware-and-operating-system" title="Permanent link">&para;</a></h2>
<p>In the following sections we discus some aspects of scheduling, hardware and settings on the OS to ensure good performance.</p>
<h3 id="cpu-and-memory-considerations">CPU and Memory considerations<a class="headerlink" href="#cpu-and-memory-considerations" title="Permanent link">&para;</a></h3>
<p>The executor nodes are the servers that host and run the actual docker containers. Drove will take into consideration the NUMA topology of these machines to optimize the placement for containers to extract the maximum performance. Along with this, Drove will <code>cpuset</code> the containers to the allocated cores in a non overlapping manner, so that the cores allocated to a container are dedicated to it. Memory allocated to a container is pinned as well and selected from the same NUMA node.</p>
<p>Needless to say the minimum amount of CPU that can be given to an application or task is 1. Fractional cpu allocation can be achieved in a predictable manner by configuring over provisioning on executor nodes.</p>
<h4 id="over-provisioning-of-cpu-and-memory">Over Provisioning of CPU and Memory<a class="headerlink" href="#over-provisioning-of-cpu-and-memory" title="Permanent link">&para;</a></h4>
<p>Drove does not do any kind of burst scaling or overcommitment to ensure application performance remains predictable even under load. Instead, in Drove, there is a feature to make executors appear to have more cores (and memory) than it actually has. This can be used to get more utilization out of executor nodes in clusters that do not need guaranteed performance (for example staging or dev testing clusters). This is achieved by enabling <strong>over provisioning</strong>.</p>
<p>Over provisioning needs to be configured in the executor configuration. It primarily consists of two configs:</p>
<ul>
<li>CPU Multiplier - an integral multiplier which will be used to multiply the number of available cores</li>
<li>Memory Multiplier - an integral multiplier which will be used to multiply available memory</li>
</ul>
<p>VCores (virtual cores) are internal representation of a CPU core on the executor. If over provisioning is disabled, a vcore will correspond to a physical core. If over provisioning is enabled, 1 CPU core will generate <code>cpu multiplier</code> number of v cores. Drove does do <code>cpuset</code> even on containers running on nodes that have over provisioning enabled, however the physical cores that the containers get bound to are chosen at random, albeit from the same NUMA node. <code>cpuset-mem</code> is always done on the same NUMA node as well.</p>
<div class="admonition tip">
<p class="admonition-title">Mixed clusters</p>
<p>In some production clusters you might have applications that are non critical in terms of performance and are unable to utilize a full core. These can be tagged to be spun up on some nodes where over provisioning is enabled. Adopting such a cluster topology will ensure that containers that need high performance run on nodes without over provisioning and the smaller apps (like for example operations consoles etc) are run on separate nodes with over provisioning enabled. Just ensure the latter are tagged properly and during app deployment specify this tag in <a href="../../applications/specification.html">application spec</a> or <a href="../../tasks/specification.html">task spec</a>.</p>
</div>
<h4 id="disable-numa-pinning">Disable NUMA Pinning<a class="headerlink" href="#disable-numa-pinning" title="Permanent link">&para;</a></h4>
<p>There is an option to disable memory and core pinning. In this situation, all cores from all NUM nodes show up as being part of one node. <code>cpuset-mems</code> is <em>not</em> called if numa pinning is disabled and therefore you will be leaving some memory performance on the table. We recommend not to dabble with this unless you have tasks and containers that need more than the number of cores available on a single NUMA node. This setting is enabled at executor level by setting <code>disableNUMAPinning: true</code>.</p>
<h4 id="hyper-threading">Hyper-threading<a class="headerlink" href="#hyper-threading" title="Permanent link">&para;</a></h4>
<p>Whether Hyper Threading needs to be enabled or not is a bit dependent on applications deployed and how effectively they can utilize individual CPU cores. For mixed workloads, we recommend Hyper Threading to be enabled on the executor nodes.</p>
<h4 id="isolating-container-and-os-processes">Isolating container and OS processes<a class="headerlink" href="#isolating-container-and-os-processes" title="Permanent link">&para;</a></h4>
<p>Typically we would not want containers to share CPU resources with processes for the operating system, Drove Executor Service as well as Docker engine (if using docker) and so on. While complete isolation would need creating a full scheduler (and passing <code>isolcpus</code> to GRUB parameters), we can get a good middle ground by ensuring such processes utilize only a few CPU cores on the system, and let the Drove executors deploy and pin containers to the rest.</p>
<p>This is achieved in two steps:</p>
<ul>
<li>Make changes to systemd to use only specific cores</li>
<li>Exclude these cores in the drove executor configuration</li>
</ul>
<p>Let's say our server has 2 NUMA nodes, each with 40 hyper-threaded cores. We want to reserve the first 2 cores from each CPU to the OS processes. So we reserve cores <code>[0,1,2,3]</code> for the OS processes.</p>
<p>The following line in <code>/etc/systemd/system.conf</code></p>
<div class="highlight"><pre><span></span><code>#CPUAffinity=
</code></pre></div>
<p>needs to be changed to</p>
<div class="highlight"><pre><span></span><code>CPUAffinity=0 1 2 3
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Reboot the machine for this to take effect.</p>
</div>
<p>The changes can be validated post reboot by running the following command:</p>
<div class="highlight"><pre><span></span><code>grep<span class="w"> </span>Cpus_allowed_list<span class="w"> </span>/proc/1/status
</code></pre></div>
<p>The expected output should be:
<div class="highlight"><pre><span></span><code>Cpus_allowed_list:  0-3
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to <a href="https://access.redhat.com/solutions/2884991">this</a> for more details.</p>
</div>
<h3 id="gpu-computation">GPU Computation<a class="headerlink" href="#gpu-computation" title="Permanent link">&para;</a></h3>
<p>Nvidia based GPU compute can be enabled at executor level by installing relevant drivers. Please follow the <a href="../../extra/nvidia.html">setup guide</a> to enable this. Remember to tag these nodes to isolate them from the primary cluster and use tags to deploy apps and tasks that need GPU.</p>
<h3 id="storage-consideration">Storage consideration<a class="headerlink" href="#storage-consideration" title="Permanent link">&para;</a></h3>
<p>On executor nodes the disk might be under pressure if container (re)deployments are frequent or the containers log very heavily. As such, we recommend the logging directory for Drove be mounted on hardware that will be able to handle this load. Similar considerations need to be given to the log and package directory for docker or podman.</p>
<h2 id="executor-configuration-reference">Executor Configuration Reference<a class="headerlink" href="#executor-configuration-reference" title="Permanent link">&para;</a></h2>
<p>The Drove Executor is written on the <a href="https://www.dropwizard.io/en/release-2.1.x/">Dropwizard</a> framework. The configuration to the service is set using a YAML file which needs to be injected into the container. A typical controller configuration file will look like the following:</p>
<div class="highlight"><pre><span></span><code><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="c1">#(1)!</span>
<span class="w">  </span><span class="nt">applicationConnectors</span><span class="p">:</span><span class="w"> </span><span class="c1">#(2)!</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
<span class="w">  </span><span class="nt">adminConnectors</span><span class="p">:</span><span class="w"> </span><span class="c1">#(3)!</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3001</span>
<span class="w">  </span><span class="nt">applicationContextPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">  </span><span class="nt">requestLog</span><span class="p">:</span>
<span class="w">    </span><span class="nt">appenders</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">console</span>
<span class="w">        </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_TIMEZONE}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_TIMEZONE}</span>
<span class="w">        </span><span class="nt">currentLogFilename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logs/drove-executor-access.log</span>
<span class="w">        </span><span class="nt">archivedLogFilenamePattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logs/drove-executor-access.log-%d-%i</span>
<span class="w">        </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">        </span><span class="nt">maxFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100MiB</span>

<span class="nt">logging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">  </span><span class="nt">loggers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">com.phonepe.drove</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_LOG_LEVEL}</span>

<span class="w">  </span><span class="nt">appenders</span><span class="p">:</span><span class="w"> </span><span class="c1">#(4)!</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">console</span><span class="w"> </span><span class="c1">#(5)!</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">      </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_TIMEZONE}</span>
<span class="w">      </span><span class="nt">logFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%(%-5level)</span><span class="nv"> </span><span class="s">[%date]</span><span class="nv"> </span><span class="s">[%logger{0}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%X{instanceLogId}]</span><span class="nv"> </span><span class="s">%message%n&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span><span class="w"> </span><span class="c1">#(6)!</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">      </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_TIMEZONE}</span>
<span class="w">      </span><span class="nt">currentLogFilename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logs/drove-executor.log</span>
<span class="w">      </span><span class="nt">archivedLogFilenamePattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logs/drove-executor.log-%d-%i</span>
<span class="w">      </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">maxFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100MiB</span>
<span class="w">      </span><span class="nt">logFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%(%-5level)</span><span class="nv"> </span><span class="s">[%date]</span><span class="nv"> </span><span class="s">[%logger{0}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%X{appId}]</span><span class="nv"> </span><span class="s">%message%n&quot;</span>
<span class="w">      </span><span class="nt">archive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">drove</span><span class="w"> </span><span class="c1">#(7)!</span>
<span class="w">      </span><span class="nt">logPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/logs/applogs/&quot;</span>
<span class="w">      </span><span class="nt">archivedLogFileSuffix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%d&quot;</span>
<span class="w">      </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TRACE</span>
<span class="w">      </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_TIMEZONE}</span>
<span class="w">      </span><span class="nt">logFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%(%-5level)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%-23date</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%-30logger{0}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%message%n&quot;</span>
<span class="w">      </span><span class="nt">archive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">zookeeper</span><span class="p">:</span><span class="w"> </span><span class="c1">#(8)!</span>
<span class="w">  </span><span class="nt">connectionString</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${ZK_CONNECTION_STRING}</span>

<span class="nt">clusterAuth</span><span class="p">:</span><span class="w"> </span><span class="c1">#(9)!</span>
<span class="w">  </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTROLLER</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_CONTROLLER_SECRET}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXECUTOR</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_EXECUTOR_SECRET}</span>

<span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c1">#(10)!</span>
<span class="w">  </span><span class="nt">osCores</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">exposedMemPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">  </span><span class="nt">disableNUMAPinning</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_DISABLE_NUMA_PINNING}</span>
<span class="w">  </span><span class="nt">enableNvidiaGpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_ENABLE_NVIDIA_GPU}</span>

<span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="c1">#(11)!</span>
<span class="w">  </span><span class="nt">cacheImages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">maxOpenFiles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10_000</span>
<span class="w">  </span><span class="nt">logBufferSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">  </span><span class="nt">cacheFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
<span class="w">  </span><span class="nt">cacheFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div>
<ol>
<li>Server listener configuration. See <a href="https://www.dropwizard.io/en/release-2.1.x/manual/configuration.html#servers" target="_blank">Dropwizard Server Configuration</a> for the different options.</li>
<li>Main port configuration. This is where the UI and APIs will be exposed. Check connector configuration <a href="https://www.dropwizard.io/en/release-2.1.x/manual/configuration.html#connectors" target="_blank">docs</a> for details.</li>
<li>Admin port. You can take thread dumps, metrics, run healthchecks on the Drove controller on this port.</li>
<li>Logging configuration. See <a href="https://www.dropwizard.io/en/release-2.1.x/manual/configuration.html#logging" target="_blank">logging docs</a>.</li>
<li>Log to console. Useful in docker-compose.</li>
<li>Log to rotating files. Useful for running servers.</li>
<li>Drove application logger configuration. See <a href="#drove-application-logger-configuration">drove logger config</a> for details.</li>
<li>Configure how to connect to Zookeeper See <a href="#zookeeper-connection-configuration">Zookeeper Config</a> for details.</li>
<li>Configuration for authentication between nodes in the cluster. Please check <a href="#intra-node-authentication-configuration">intra node auth config</a> for details.</li>
<li>Resource configuration for this node.</li>
<li>Options to configure executor behaviour. Check <a href="#executor-options">executor options</a> section for details.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In case you do not want to expose admin apis to outside the host, please set <code>bindHost</code> in the admin connectors section.</p>
<div class="highlight"><pre><span></span><code><span class="nt">adminConnectors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10001</span>
<span class="w">    </span><span class="nt">bindHost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
</code></pre></div>
</div>
<h3 id="zookeeper-connection-configuration">Zookeeper Connection Configuration<a class="headerlink" href="#zookeeper-connection-configuration" title="Permanent link">&para;</a></h3>
<p>The following details can be configured.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Connection String</td>
<td><code>connectionString</code></td>
<td>The connection string of the form: <code>zkserver:2181,zkserver2:2181...</code></td>
</tr>
<tr>
<td>Data namespace</td>
<td><code>namespace</code></td>
<td>The top level node inside which all Drove data will be scoped. Defaults to <code>drove</code> if not set.</td>
</tr>
</tbody>
</table>
<p><strong>Sample</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">zookeeper</span><span class="p">:</span>
<span class="w">  </span><span class="nt">connectionString</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.168.3.10:2181,192.168.3.11:2181,192.168.3.12:2181&quot;</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">drovetest</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is same across the cluster including both controller and executor.</p>
</div>
<h3 id="intra-node-authentication-configuration">Intra Node Authentication Configuration<a class="headerlink" href="#intra-node-authentication-configuration" title="Permanent link">&para;</a></h3>
<p>Communication between controller and executor is protected by a shared-secret based authentication. The following configuration is meant to configure this. This section consists of a list of 2 members:</p>
<ul>
<li>Config for controller to talk to executors</li>
<li>Config for executors to talk to controller</li>
</ul>
<p>Each section consists of the following:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node Type</td>
<td><code>nodeType</code></td>
<td>Type of node in the cluster. Can be <code>CONTROLLER</code> or <code>EXECUTOR</code></td>
</tr>
<tr>
<td>Secret</td>
<td><code>secret</code></td>
<td>The actual secret to be passed.</td>
</tr>
</tbody>
</table>
<p><strong>Sample</strong>
<div class="highlight"><pre><span></span><code><span class="nt">clusterAuth</span><span class="p">:</span>
<span class="w">  </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTROLLER</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ControllerSecretValue</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXECUTOR</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExecutorSecret</span>
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is same across the cluster including both controller and executor.</p>
</div>
<h3 id="drove-application-logger-configuration">Drove Application Logger Configuration<a class="headerlink" href="#drove-application-logger-configuration" title="Permanent link">&para;</a></h3>
<p>Drove will segregate application and task instance logs in a directory of your choice. The path for such files is set as:
- <code>&lt;application id&gt;/&lt;instance id&gt;</code> for Application Instances
- <code>&lt;sourceAppName&gt;/&lt;task id&gt;</code> for Task Instances</p>
<p>The Drove Log Appender is based of LogBack's <a href="https://logback.qos.ch/manual/appenders.html#SiftingAppender">Sifting Appender</a>.</p>
<p>The following configuration options are supported:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Path</td>
<td><code>logPath</code></td>
<td>Directory to host the logs</td>
</tr>
<tr>
<td>Archive old logs</td>
<td><code>archive</code></td>
<td>Whether to enable log rotation</td>
</tr>
<tr>
<td>Archived File Suffix</td>
<td><code>archivedLogFileSuffix</code></td>
<td>Suffix for archived log files.</td>
</tr>
<tr>
<td>Archived File Count</td>
<td><code>archivedFileCount</code></td>
<td>Count of archived log files. Older files are deleted.</td>
</tr>
<tr>
<td>File Size</td>
<td><code>maxFileSize</code></td>
<td>Size of current log file after which it is archived and a new file is created. Unit: <a href="units.html#data-size">DataSize</a>.</td>
</tr>
<tr>
<td>Total Size</td>
<td><code>totalSizeCap</code></td>
<td>total size after which deletion takes place. Unit: <a href="units.html#data-size">DataSize</a>.</td>
</tr>
<tr>
<td>Buffer Size</td>
<td><code>bufferSize</code></td>
<td>Buffer size for the logger. (Set to 8KB by default). Used if <code>immediateFlush</code> is turned off.</td>
</tr>
<tr>
<td>Immediate Flush</td>
<td><code>immediateFlush</code></td>
<td>Flush logs immediately. Set to <code>true</code> by default (recommended)</td>
</tr>
</tbody>
</table>
<p><strong>Sample</strong>
<div class="highlight"><pre><span></span><code><span class="nt">logging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="w">  </span><span class="nt">appenders</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Setup appenders for the executor process itself first</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">- type</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">drove</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">logPath</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;/logs/applogs/&quot;</span>
<span class="w">      </span><span class="nt">archivedLogFileSuffix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%d&quot;</span>
<span class="w">      </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TRACE</span>
<span class="w">      </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DROVE_TIMEZONE}</span>
<span class="w">      </span><span class="nt">logFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%(%-5level)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%-23date</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%-30logger{0}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%message%n&quot;</span>
<span class="w">      </span><span class="nt">archive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<h3 id="resource-configuration">Resource Configuration<a class="headerlink" href="#resource-configuration" title="Permanent link">&para;</a></h3>
<p>This section can be used to configure how resources are exposed from an executor to the cluster. We have <a href="#considerations-and-tuning-for-hardware-and-operating-system">discussed</a> a few of the considerations that will drive the configuration that is being setup.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>OS Cores</td>
<td><code>osCores</code></td>
<td>A list of cores reserved for use by operating system processes. See the <a href="#isolating-container-and-os-processes">relevant section</a> for details on the pre-steps needed to achieve this.</td>
</tr>
<tr>
<td>Exposed Memory</td>
<td><code>exposedMemPercentage</code></td>
<td>What percentage of the system memory can be used by the containers running on the host collectively. Range: 50-100 <code>integer</code></td>
</tr>
<tr>
<td>NUMA Pinning</td>
<td><code>disableNUMAPinning</code></td>
<td>Disable NUMA and CPU core pinning for containers. Pinning is on by default. (default: <code>false</code>)</td>
</tr>
<tr>
<td>Nvidia GPU</td>
<td><code>enableNvidiaGpu</code></td>
<td>Enable GPU support on containers. This setting makes all available Nvidia GPUs on the current executor machine available for any container running on this executor. GPU resources are not discovered on the executor, managed and rationed between containers. Needs to be used in conjunction with tagging (see <code>tags</code> below) to ensure only the applications which require a GPU end up on the executor with GPUs.</td>
</tr>
<tr>
<td>Tags</td>
<td><code>tags</code></td>
<td>A set of strings that can be used in <code>TAG</code> placement policy to route application and task instances to this executor.</td>
</tr>
<tr>
<td>Over Provisioning</td>
<td><code>overProvisioning</code></td>
<td>Setup over provisioning configuration.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Tagging</p>
<p>The current hostname is <em>always</em> added as a tag by default and is handled specially to allow for non-tagged deployments to be routed to this executor. If <em>any</em> tag is specified in the <code>tags</code> config, this node will receive containers <strong><em>only</em></strong> when <code>MATCH_TAG</code> placement is used. Please check relevant sections to specify correct placement policies for <a href="../../applications/specification.html#placement-policy-specification">applications</a> and <a href="../../tasks/specification.html#placement-policy-specification">tasks</a>.</p>
</div>
<p><strong>Sample</strong>
<div class="highlight"><pre><span></span><code><span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">osCores</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="nv">3</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">exposedMemPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
</code></pre></div></p>
<h4 id="over-provisioning-configuration">Over provisioning configuration<a class="headerlink" href="#over-provisioning-configuration" title="Permanent link">&para;</a></h4>
<p>Drove strives to ensure that containers can run unencumbered on CPU cores allocated to them. This means that the <em>minimum</em> allocation unit possible is <code>1</code> for cores. It <em>does not</em> support fractional CPU.</p>
<p>However, there are situations where we would want some non-critical applications to run the cluster but not waste CPU. The <code>overProvisioning</code> configuration aims to provide user a way to turn off NUMA pinning on the executor and run more containers than it normally would.</p>
<p>To ensure predictability, we do not want pinned and non-pinned containers running on the same host. Hence, an executor host can either be running in pinned mode or in non-pinned mode.</p>
<p>To enable more containers than we could usually deploy and to still retain some level of control on how small you want a container to go, we specify multipliers on CPU and memory.</p>
<p><strong>Example:</strong>
- Let's say your executor server has 40 cores available. If you set <code>cpuMultiplier</code> as 4, this node will now show up as having 160 cores to the controller.
- Let's say your server had 512GB of memory, setting <code>memoryMultiplier</code> to 2 will make drove see it as 1TB.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Enabled</td>
<td><code>enabled</code></td>
<td>Set this to true to enable over provisioning. Default: <code>false</code></td>
</tr>
<tr>
<td>CPU Multiplier</td>
<td><code>cpuMultiplier</code></td>
<td>Multiplier to be applied to enable cpu over provisioning. Default: <code>1</code>. Range: 1-20</td>
</tr>
<tr>
<td>Memory Multiplier</td>
<td><code>memoryMultiplier</code></td>
<td>Multiplier to be applied to enable memory over provisioning. Default: <code>1</code>. Range: 1-20</td>
</tr>
</tbody>
</table>
<p><strong>Sample</strong>
<div class="highlight"><pre><span></span><code><span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">exposedMemPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">  </span><span class="nt">overProvisioning</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">memoryMultiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">cpuMultiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This feature was developed to allow us to run our development environments cheaper. In such environments there is not much pressure on CPU or memory, but a large number of containers run as developers can spin up containers for features they are working on. There was no point is wasting a full core on containers that get hit twice a minute or less. On production we tend to err on the side of caution and allocate at least one core even to the most trivial applications as of the time of writing this.</p>
</div>
<h3 id="executor-options">Executor Options<a class="headerlink" href="#executor-options" title="Permanent link">&para;</a></h3>
<p>The following options can be set to influence the behavior for the Drove executors.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hostname</td>
<td><code>hostname</code></td>
<td>Override the hostname that gets exposed to the controller. Make sure this is resolvable.</td>
</tr>
<tr>
<td>Cache Images</td>
<td><code>cacheImages</code></td>
<td>Cache container images. If this is not passed, a container image is removed when a container dies and no other instance is using the image.</td>
</tr>
<tr>
<td>Command Timeout</td>
<td><code>containerCommandTimeout</code></td>
<td>Timeout used by the container engine client when issuing container commands to <code>docker</code> or <code>podman</code></td>
</tr>
<tr>
<td>Container Socket Path</td>
<td><code>dockerSocketPath</code></td>
<td>The path of socket for docker socket. Comes in handy to configure path for socket when using <code>podman</code> etc.</td>
</tr>
<tr>
<td>Max Open Files</td>
<td><code>maxOpenFiles</code></td>
<td>Override the maximum number of file descriptors a container can open. Default: 470,000</td>
</tr>
<tr>
<td>Log Buffer Size</td>
<td><code>logBufferSize</code></td>
<td>The size of the buffer the executor uses to read logs from container. Unit <a href="units.html#data-size">DataSize</a>. Range: 1-128MB. Default: 10MB</td>
</tr>
<tr>
<td>Cache File Size</td>
<td><code>cacheFileSize</code></td>
<td>To limit disk usage, configure fixed size log file cache for containers. Unit: <a href="units.html#data-size">DataSize</a>. Range: 10MB-100GB. Default: 20MB. Compression is always enabled.</td>
</tr>
<tr>
<td>Cache File Count</td>
<td><code>cacheFileSize</code></td>
<td>To limit disk usage, configure fixed count of log file cache for containers. Unit: <code>integer</code>. Max: 1024. Default: 3</td>
</tr>
</tbody>
</table>
<p><strong>Sample</strong>
<div class="highlight"><pre><span></span><code><span class="nt">options</span><span class="p">:</span>
<span class="w">  </span><span class="nt">logBufferSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20m</span>
<span class="w">  </span><span class="nt">cacheFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30m</span>
<span class="w">  </span><span class="nt">cacheFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">cacheImages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<h2 id="relevant-directories">Relevant directories<a class="headerlink" href="#relevant-directories" title="Permanent link">&para;</a></h2>
<p>Location for data and logs are as follows:</p>
<ul>
<li><code>/etc/drove/executor/</code> - Configuration files</li>
<li><code>/var/log/drove/executor/</code> - Executor Logs</li>
<li><code>/var/log/drove/executor/instance-logs</code> - Application/Task Instance Logs</li>
</ul>
<p>We shall be volume mounting the config and log directories with the same name.</p>
<div class="admonition warning">
<p class="admonition-title">Prerequisite Setup</p>
<p>If not done already, please complete the <a href="prerequisites.html">prerequisite setup</a> on all machines earmarked for the cluster.</p>
</div>
<h2 id="setup-the-config-file">Setup the config file<a class="headerlink" href="#setup-the-config-file" title="Permanent link">&para;</a></h2>
<p>Create a relevant configuration file in <code>/etc/drove/controller/executor.yml</code>.</p>
<p><strong>Sample</strong>
<div class="highlight"><pre><span></span><code><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">applicationConnectors</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">11000</span>
<span class="w">  </span><span class="nt">adminConnectors</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">11001</span>
<span class="w">  </span><span class="nt">requestLog</span><span class="p">:</span>
<span class="w">    </span><span class="nt">appenders</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">        </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IST</span>
<span class="w">        </span><span class="nt">currentLogFilename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/drove/executor/drove-executor-access.log</span>
<span class="w">        </span><span class="nt">archivedLogFilenamePattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/drove/executor/drove-executor-access.log-%d-%i</span>
<span class="w">        </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">        </span><span class="nt">maxFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100MiB</span>

<span class="nt">logging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">  </span><span class="nt">loggers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">com.phonepe.drove</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>


<span class="w">  </span><span class="nt">appenders</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ALL</span>
<span class="w">      </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IST</span>
<span class="w">      </span><span class="nt">currentLogFilename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/drove/executor/drove-executor.log</span>
<span class="w">      </span><span class="nt">archivedLogFilenamePattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/drove/executor/drove-executor.log-%d-%i</span>
<span class="w">      </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">maxFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100MiB</span>
<span class="w">      </span><span class="nt">logFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%(%-5level)</span><span class="nv"> </span><span class="s">[%date]</span><span class="nv"> </span><span class="s">[%logger{0}</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">%X{appId}]</span><span class="nv"> </span><span class="s">%message%n&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">drove</span>
<span class="w">      </span><span class="nt">logPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/log/drove/executor/instance-logs&quot;</span>
<span class="w">      </span><span class="nt">archivedLogFileSuffix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%d-%i&quot;</span>
<span class="w">      </span><span class="nt">archivedFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">      </span><span class="nt">maxFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1GiB</span>
<span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>
<span class="w">      </span><span class="nt">timeZone</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IST</span>
<span class="w">      </span><span class="nt">logFormat</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;%(%-5level)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%-23date</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%-30logger{0}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">%message%n&quot;</span>
<span class="w">      </span><span class="nt">archive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">zookeeper</span><span class="p">:</span>
<span class="w">  </span><span class="nt">connectionString</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.168.56.10:2181&quot;</span>

<span class="nt">clusterAuth</span><span class="p">:</span>
<span class="w">  </span><span class="nt">secrets</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONTROLLER</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0v8XvJrDc7r86ZY1QCByPTDPninI4Xii&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXECUTOR</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pOd9sIEXhv0wrGOVc7ebwNvR7twZqyTN&quot;</span>

<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">osCores</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">exposedMemPercentage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">  </span><span class="nt">disableNUMAPinning</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">overProvisioning</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">memoryMultiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">cpuMultiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="nt">options</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cacheImages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">logBufferSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20m</span>
<span class="w">  </span><span class="nt">cacheFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30m</span>
<span class="w">  </span><span class="nt">cacheFileCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">cacheImages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></p>
<h2 id="setup-required-environment-variables">Setup required environment variables<a class="headerlink" href="#setup-required-environment-variables" title="Permanent link">&para;</a></h2>
<p>Environment variables need to run the drove controller are setup in <code>/etc/drove/executor/executor.env</code>.</p>
<div class="highlight"><pre><span></span><code>CONFIG_FILE_PATH<span class="s">=/etc/drove/executor/executor.yml</span>
JAVA_PROCESS_MIN_HEAP<span class="s">=1g</span>
JAVA_PROCESS_MAX_HEAP<span class="s">=1g</span>
ZK_CONNECTION_STRING<span class="s">=&quot;192.168.56.10</span><span class="p">:</span><span class="m">2181</span><span class="s">&quot;</span>
JAVA_OPTS<span class="s">=&quot;-Xlog</span><span class="p">:</span>gc<span class="p">:</span><span class="s">/var/log/drove/executor/gc.log -Xlog</span><span class="p">:</span>gc<span class="p">:::</span>filecount<span class="s">=3,filesize=10M -Xlog</span><span class="p">:</span>gc<span class="p">::</span>time,level,tags -XX<span class="p">:</span><span class="s">+UseNUMA -XX</span><span class="p">:</span><span class="s">+ExitOnOutOfMemoryError -Djava.security.egd=file</span><span class="p">:</span><span class="s">/dev/urandom -Dfile.encoding=utf-8 -Djute.maxbuffer=0x9fffff&quot;</span>
</code></pre></div>
<h2 id="create-systemd-file">Create systemd file<a class="headerlink" href="#create-systemd-file" title="Permanent link">&para;</a></h2>
<p>Create a <code>systemd</code> file. Put the following in <code>/etc/systemd/system/drove.executor.service</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">Drove Executor Service</span>
<span class="na">After</span><span class="o">=</span><span class="s">docker.service</span>
<span class="na">Requires</span><span class="o">=</span><span class="s">docker.service</span>

<span class="k">[Service]</span>
<span class="na">User</span><span class="o">=</span><span class="s">drove</span>
<span class="na">Group</span><span class="o">=</span><span class="s">docker</span>
<span class="na">TimeoutStartSec</span><span class="o">=</span><span class="s">0</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">ExecStartPre</span><span class="o">=</span><span class="s">-/usr/bin/docker pull ghcr.io/phonepe/drove-executor:latest</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/docker run  </span>\
<span class="w">    </span><span class="s">--env-file /etc/drove/executor/executor.env </span>\
<span class="w">    </span><span class="s">--volume /etc/drove/executor:/etc/drove/executor:ro </span>\
<span class="w">    </span><span class="s">--volume /var/log/drove/executor:/var/log/drove/executor </span>\
<span class="w">    </span><span class="s">--volume /var/run/docker.sock:/var/run/docker.sock </span>\
<span class="w">    </span><span class="s">--publish 11000:11000  </span>\
<span class="w">    </span><span class="s">--publish 11001:11001 </span>\
<span class="w">    </span><span class="s">--hostname %H </span>\
<span class="w">    </span><span class="s">--rm </span>\
<span class="w">    </span><span class="s">--name drove.executor </span>\
<span class="w">    </span><span class="s">ghcr.io/phonepe/drove-executor:latest</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>
Verify the file with the following command:
<div class="highlight"><pre><span></span><code>systemd-analyze<span class="w"> </span>verify<span class="w"> </span>drove.executor.service
</code></pre></div></p>
<p>Set permissions
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span><span class="m">664</span><span class="w"> </span>/etc/systemd/system/drove.executor.service
</code></pre></div></p>
<h2 id="start-the-service-on-all-servers">Start the service on all servers<a class="headerlink" href="#start-the-service-on-all-servers" title="Permanent link">&para;</a></h2>
<p>Use the following to start the service:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>daemon-reload
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>drove.executor
systemctl<span class="w"> </span>start<span class="w"> </span>drove.executor
</code></pre></div>
<p>You can tail the logs at <code>/var/log/drove/executor/drove-executor.log</code>.</p>
<p>The executor should now show up on the Drove Console.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024  PhonePe Private Limited
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "content.code.annotate", "navigation.expand", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  <script id="init-glightbox">document.querySelectorAll('.glightbox').forEach(function(element) {
    try {
        var img = element.querySelector('img');
        if (img && img.src) {
            element.setAttribute('href', img.src);
        } else {
            console.log('No img element with src attribute found');
        }
    } catch (error) {
        console.log('Error:', error);
    }
});
const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>